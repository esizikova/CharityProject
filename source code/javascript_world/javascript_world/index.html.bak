<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Javascript World Map</title>
        <link rel="stylesheet" href="css/demo.css" type="text/css" media="screen">
        <link rel="stylesheet" href="css/demo-print.css" type="text/css" media="print">

        <script src="js/raphael_2.0.2.js" type="text/javascript"></script>
        <script src="js/world_1000.js" type="text/javascript"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
		<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
		<script src="http://code.jquery.com/ui/1.9.1/jquery-ui.js"></script>
        <script type="text/javascript">        
            window.onload = function () {
				var current = null;
				var map = {};
				var m = {};	
				var orgMod = false;					
				var attr = {
					fill: "#333",
					stroke: "#888",
					"stroke-width": .5,
					"stroke-linejoin": "round"
				};				
				var map = {};
				var R = Raphael("holder_1000");
				render_map(R,map,attr);	
				if (orgMod == false) {				
				for (var state in map) {							        
    	            map[state].color = Raphael.getColor();
	                (function (st, state) {
						st[0].style.cursor = "pointer";
						st[0].onmouseover = function () {
							current && map[current].animate({fill: "#333", stroke: "#666"}, 300);
							st.animate({fill: st.color, stroke: "#ccc"}, 300);
							R.safari();
							current = state;
						};
						st[0].onmouseout = function () {
							st.animate({fill: "#333", stroke: "#666"}, 300);
							R.safari();
						};
						
						st[0].onclick = function () {
							alert(state);
						};
					})(map[state], state);
				}; // end for
				}
				

				function lon2x(lon) {
					var xfactor = 2.752;
					var xoffset = 473.75;
					var x = (lon * xfactor) + xoffset;
					return x;
				}
				function lat2y(lat) {
					var yfactor = -2.753;
					var yoffset = 231;
					var y = (lat * yfactor) + yoffset;
					return y;
				}
				
				var aidPoint_attr = {
					fill: "#0f0",
					stroke: "none",
					opacity: .6
				};
					function plot(lat,lon,size) {
					size = size * .5 + 4;
					return R.circle(lon2x(lon), lat2y(lat), size).attr(aidPoint_attr);
					var menuId = $("ul.nav").first().attr("id");
				}
				
				var cities = {};var org_attr = {
					fill: "#2B11D6",
					stroke: "none",
					opacity: 0.3
				};
				

				var orgs = {};
				
				function plot2(lat,lon,size) {
					size = size * .5 + 4;
					return R.circle(lon2x(lon), lat2y(lat), size).attr(org_attr);
				}
				
				orgs.WaterAid = plot2(-100,-120,80);
				var rcities = [{cname: "Kenya", ccode: "KE", fund: 120},{cname: "China", ccode: "CN", fund: 50}]
				var current_org = null;
				var org_box = null;
				for (var org in orgs) {	
    	            map[state].color = Raphael.getColor();
	                (function (st, org) {
					    
						var clickTime = 0;
						st[0].style.cursor = "pointer";
						st[0].onmouseover = function () {
							if (t = document.getElementById(org_box)) { t.style.display = "none"; }
							if (t = document.getElementById(org)) { t.style.display = "block"; }
							org_box = org;
						};
						st[0].onmouseout = function () {
							//R.safari();
						};
						st[0].onclick = function () {
						    if (clickTime == 0) {
								current_org && cities[current_org].animate({fill: "#2B11D6", opacity: .1}, 300);
								st.animate({fill: "#2B11D6", opacity: 1}, 300);
								current_city = city;
								for (var rcity in rcities) {
									var i = rcities[rcity].fund * 0.01;
									map[rcities[rcity].ccode].animate({fill: "#2B11D6", opacity: i}, 300);
								}
							orgMod = true;
							clickTime = 1;
							}
							else {
								st.animate({fill: "#2B11D6", opacity: 0.3}, 300);
								for (var rcity in rcities) {
								map[rcities[rcity].ccode].animate({fill: "#333", opacity: 1}, 300);
								}
							clickTime = 0;
							orgMod = false;
							}
							R.safari();
						};


						/*if (t = document.getElementById(org)) {
								t.style.left = orgs[org].attr('cx') + 'px';
								t.style.top = orgs[org].attr('cy') -20 + 'px';
						}*/

					})(orgs[org], org);
				};
				
				
				var current_city = null;
				var city_box = null;
				if (orgMod == false){
				for (var city in cities) {							        
    	            map[state].color = Raphael.getColor();
	                (function (st, city) {
						st[0].style.cursor = "pointer";
						st[0].onmouseover = function () {
							current_city && cities[current_city].animate({fill: "#0f0", opacity: .3}, 300);
							st.animate({fill: "#0f0", opacity: 1}, 300);
							R.safari();
							current_city = city;
						};
						st[0].onmouseout = function () {
							st.animate({fill: "#0f0", opacity: .3}, 300);
							R.safari();
						};
						
						st[0].onclick = function () {
							if (t = document.getElementById(city_box)) { t.style.display = "none"; }
							if (t = document.getElementById(city)) { t.style.display = "block"; }
							city_box = city;
						};


						if (t = document.getElementById(city)) {
								t.style.left = cities[city].attr('cx') + 'px';
								t.style.top = cities[city].attr('cy') -20 + 'px';
						}

					})(cities[city], city);
				}; // end for
				}
			
				var aidPoints = {};
				
				//function getAidPoints() {
					$.get("/backend/getAidPoints",
					function(data){
						//console.log (data)
						var namey;
						var yieldy;
						var lony;
						var laty;
					//	var data = [{name: "Bronwen", lon : 40.143105, lat: 47.576927, yield: 30},{name: "Fred", lon : -16.290154, lat: 63.588653, yield: 10}];
						for (var x in data)
							{
								console.log(data[x].name);
								namey = data[x].name;
								yieldy = data[x].yield;
								lony = data[x].lon;
								laty = data[x].lat;
								$('#holder_1000').append('<div id='+namey+' class="aidPoint_hover"><span class="a_label"><strong><strong>'+namey+'</strong></strong><br /></span></div>');
								aidPoints[namey] = plot (lony, laty, yieldy);
							}
					}, "json");
				//}

				var current_aidPoint = null;
				for (var aidPoint in aidPoints) {							        
    	            map[state].color = Raphael.getColor();
	                (function (st, aidPoint) {
						st[0].style.cursor = "pointer";
						st[0].onmouseover = function () {
						    current_aidPoint && aidPoints[current_aidPoint].animate({fill: "#0f0", opacity: 0.3}, 300);
							st.animate({fill: "#0f0", opacity: 1}, 300);
							R.safari();
							current_aidPoint = aidPoint;
							
							if (t = document.getElementById(current_aidPoint)) { t.style.display = "block";console.log("hi");}
						};
						st[0].onmouseout = function () {
							st.animate({fill: "#0f0", opacity: .6}, 300);
							R.safari();
							if (t = document.getElementById(current_aidPoint)) { t.style.display = "none"; }
							};
						
						st[0].onclick = function () {
						//	go to water point page
						};

						if (t = document.getElementById(aidPoint)) {
								t.style.left = aidPoints[aidPoint].attr('cx') + 'px';
								t.style.top = aidPoints[aidPoint].attr('cy') -20 + 'px';
						}

					})(aidPoints[aidPoint], aidPoint);
				}; // end for


			};
			function filteringfun()
				{
				console.log("checked");
				var variouschecks=$(':checkbox');
				console.log(variouschecks.length);
				var txt="";
				var i;
					for (i=0;i<variouschecks.length;i++)
					  {
					  if (variouschecks[i].checked)
						{
						txt=txt + variouschecks[i].value + " ";
						}
					  }
					  if (t = document.getElementById("KE")) { t.style.display = "block"; }
							if (t = document.getElementById(city)) { t.style.display = "block"; }
				}
			$(function() {
		$( "#filter" ).accordion({ active: false, collapsible: true });
    });
        </script>
    </head>
    <body>
        <div id="holder_1000" style="position:relative;">
		<div id="filter">
    <caption>Filters</caption>
    
<h3>Region</h3>

    <div>
        <p></p>
        <div id=reg>
            <label>
                <input name="gen" value=="SAM" type="checkbox" onclick="filteringfun()" />South America</label>
            <br>
            <label>
                <input name="gen" value=="AFR" type="checkbox" onclick="filteringfun()" />Africa</label>
        </div>
    </div>
     <h3>Monetary value</h3>

    <div>
        <p></p>
        <div id=mon>
            <label>
                <input name="gen" value=="HI" type="checkbox" onclick="filteringfun()" />High</label>
            <br>
            <label>
                <input name="gen" value=="LO" type="checkbox" onclick="filteringfun()" />Low</label>
        </div>
    </div>
    
<h3>Type of aid</h3>

    <div>
        <p></p>
        <div id=aid>
            <label>
                <input name="gen" value=="TYPE1" type="checkbox" onclick="filteringfun()" />1</label>
            <br>
            <label>
                <input name="gen" value=="TYPE2" type="checkbox" onclick="filteringfun()" />2</label>
        </div>
    </div>
    
<h3>Duration of aid</h3>

    <div>
        <p></p>
        <div id=dur>
            <label>
                <input name="gen" value=="LONG" type="checkbox" onclick="filteringfun()" />Long</label>
            <br>
            <label>
                <input name="gen" value=="SHORT" type="checkbox" onclick="filteringfun()" />Short</label>
        </div>
    </div>
     <h3>Number of water points</h3>

    <div>
        <p></p>
        <div id=wat>
            <label>
                <input name="gen" value=="MORE" type="checkbox" onclick="filteringfun()" />More than 100</label>
            <br>
            <label>
                <input name="gen" value=="LESS" type="checkbox" onclick="filteringfun()" />Less than 100</label>
        </div>
	</div>
</body>
</html>