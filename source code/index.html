<html xml:lang="en" lang="en"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ex="http://simile.mit.edu/2006/11/exhibit#">
<head>
    <title>WA Internal IATI Viewer</title>
    <!-- <link href="http://iatiexplorer.org/explorer/iatixslt.php?q=//iati-activity[recipient-country/@code='AF'][reporting-org/@ref='GB-1']&howmany=500" type="application/json" rel="exhibit/data" /> -->
    <link href="./data/V2WACP.json" type="application/json" rel="exhibit/data" />

<!-- web load-->
<script src="http://api.simile-widgets.org/exhibit/2.2.0/exhibit-api.js" type="text/javascript"></script>
<script src="http://api.simile-widgets.org/exhibit/2.2.0/extensions/time/time-extension.js"></script>
<script src="http://api.simile-widgets.org/exhibit/2.2.0/extensions/map/map-extension.js"></script>

<!-- local load
<script src="file:///D:/simile-widgets-read-only/src/ajax/api/simile-ajax-api.js?bundle=false" type="text/javascript"></script>
<script src="file:///D:/simile-widgets-read-only/src/webapp/api/exhibit-api.js?bundle=false" type="text/javascript"></script>
<script src="file:///D:/simile-widgets-read-only/src/webapp/api/extensions/time/time-extension.js" type="text/javascript"></script>
<script src="file:///D:/simile-widgets-read-only/src/webapp/api/extensions/map/map-extension.js" type="text/javascript"></script>
-->

<!-- alternative load locations for timeline
from the svn <script src="http://simile.mit.edu/repository/exhibit/branches/2.0/src/webapp/api/exhibit-api.js?views=timeline"type="text/javascript"></script>
<script src="http://static.simile.mit.edu/exhibit/extensions-2.0/time/time-extension.js"></script>
This one doesnt work for IE <script src="http://api.simile-widgets.org/exhibit/2.2.0/extensions/time/time-extension.js" type="text/javascript"></script>
suggestion on http://osdir.com/ml/web.simile.general/2007-07/msg00001.html is to use: (however, doesnt seem to like load function below)
<script src="http://static.simile.mit.edu/exhibit/api-2.0/exhibit-api.js?views=timeline" type="text/javascript"></script>-->

    <!-- For quick local/web switching
    <script type="text/javascript">
        function load(url) {
            var script = '<script type="text/javascript" src="' + url + '"></scr' + 'ipt>\n';
            document.write(script);
        }
        if (location.protocol != "file:") { // 1) { // force local development
            load("http://api.simile-widgets.org/exhibit/2.2.0/exhibit-api.js");
            // following doesnt seem to work for IE - maybe because of type attribute?
            load("http://api.simile-widgets.org/exhibit/2.2.0/extensions/time/time-extension.js");
            load("http://api.simile-widgets.org/exhibit/2.2.0/extensions/map/map-extension.js?gmapkey=ABQIAAAAQSFWwpkd1fQglhMR2pNH5RTmVTZsJUKj5tFMbJjSEmN27K1_vRRurk1qskR35IkiK6PRihei3yFGbA");
        } else {
            load("file:///D:/simile-widgets-read-only/src/ajax/api/simile-ajax-api.js?bundle=false");
            load("file:///D:/simile-widgets-read-only/src/webapp/api/exhibit-api.js?bundle=false");
            // suspect I dont need this as use standard simile ajax from exhibit? load("file:///D:/simile-timeline_2.3.0/src/ajax/api//simile-ajax-api.js?bundle=false");
            // timeline doesnt work following the documentation (it's out of date), see workaround below load("file:///D:/simile-timeline_2.3.0/src/webapp/api/timeline-api.js?bundle=false");
            //edited the following so that local files are loaded rather than web so get faster load time for development, and it registers timeline, but does not serve up through ajax... - line 47
            load("file:///D:/simile-widgets-read-only/src/webapp/api/extensions/time/time-extension.js");
            load("file:///D:/simile-widgets-read-only/src/webapp/api/extensions/map/map-extension.js?gmapkey=ABQIAAAAQSFWwpkd1fQglhMR2pNH5RTmVTZsJUKj5tFMbJjSEmN27K1_vRRurk1qskR35IkiK6PRihei3yFGbA");
        }
    </script> -->

<script src="./exhibit-helpers.js" type="text/javascript"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
<script src="thickbox-compressed.js"></script>

<link media="screen" rel="stylesheet" href="thickbox.css" />

    <script>
        var zebraStyler = function (item, database, tr) {
            if (tr.rowIndex % 2) {
                tr.style.background = '#eee';
            } else {
                tr.style.background = '#ccc';
            }
        }
</script>

<script type="text/javascript">
    function datePlease() {
        return Date.now()
    }
                </script>

<script type="text/javascript"><!--
	function showThickbox(a){
	var t = a.title || a.name || null;
	var g = a.rel || false;
	tb_show(t,a.href,g);
	a.blur();
	return false;
	};
	/*
	function viewSelectedExhibit(x){
	var cls = $(x).attr('class');
	if(cls == 'selectedView')
		{
			$('.exhibit-viewPanel-viewSelection-selectedView').removeClass('exhibit-viewPanel-viewSelection-selectedView').addClass('exhibit-viewPanel-viewSelection-view');
		}

	if(cls == 'exhibit-viewPanel-viewSelection-view')
		$('.exhibit-viewPanel-viewSelection-view').removeClass('exhibit-viewPanel-viewSelection-view').addClass('exhibit-viewPanel-viewSelection-selectedView');
	}
	function viewSelectExhibit(){
	$('.exhibit-viewPanel-viewSelection-view').addClass('exhibit-viewPanel-viewSelection-selectedView');
	}
	*/
	function viewTiles(x){
	$(x).click(function () {
	var title = $('.exhibit-viewPanel-viewSelection-view').attr('title');
	if(title=="View items in a table")
		{
			$('span.exhibit-viewPanel-viewSelection-view').trigger('click');
			//alert($('.exhibit-viewPanel-viewSelection-view').text())
		}
	});

	}

	function viewTables(x){
	$(x).click(function () {
	var title = $('.exhibit-viewPanel-viewSelection-view').attr('title');
	if(title=="View items as tiles in a list"){
			$('span.exhibit-viewPanel-viewSelection-view').trigger('click');
			//alert($('.exhibit-viewPanel-viewSelection-view').text());
		}
	});

	}

--></script>

<link rel="stylesheet" type="text/css" href="style.css" title="Default Styles" />
<style>
a.exhibit-item, a.exhibit-item:link, a.exhibit-item:active, a.exhibit-item:visited {
text-decoration: none;
border-bottom: none;
cursor: pointer;
}
a.flnk1{display:block;float:left;height:59px;width:200px;text-indent:-9999px;outline:none;}
</style>
</head>
<body class="results">
	<div id="header">
    <div style="float: left; background: url(./img/WAh1.jpg) repeat-x; height:70px;width:305px;border-bottom:1px solid #cecece;position:relative;margin:0 auto;"> </div>
		<span id="logo" ondblclick="return logo_ondblclick()"><a href="http://www.wateraid.org/uk/" class="flnk1" title="WaterAid UK site" target="_blank">WaterAid UK site</a></span>
		<div id="currently">
        <!--<div class="exhibit-viewPanel-viewSelection"  style="padding-top: 20px;">
				Display:
			<span id="Span1" onclick="javascript:viewTables(this)"><img src="./img/tiles.gif"></span>
			<span id="Span2" onclick="javascript:viewTiles(this)"><img src="./img/tabel.gif"></span>
		</div>-->
		<div class="exhibit-viewPanel-viewSelection"  style="padding-top: 20px;">
			Export XML:
            <!--<span id="Span3" onclick="javascript:return alert('Export selected projects coming')"><img src="./img/export.png"></span>-->
            <a id="Span4" href="./data/V2WACP.xml" target="_blank"><img src="./img/export.png" width="18px" height="17px"/></a>
		</div>
        <div class="clearer"></div>
        </div>
	</div>
	<!--
	<div class="exhibit-table" style="background:#fff;">
	-->

	<div id="Div1">
	    <div id="nav">
            <h1>Internal visualisation tool for WaterAid Annual Country Programme data</h1>
	    </div>
	    <div id="Div2">
            Data is taken from the <abbr title="WaterAid">WA</abbr> external facing annual reports<a href="http://www.wateraid.org/documents/annual_report_and_financial_statements_201011.pdf#page=47" target="_blank" style="font-size: 14px;">pages 46 and 47</a>(<img title="PDF File" alt="PDF File" src="./img/pdf.gif" border="0" height="16" width="16"> PDF File 893KB) for the 2010-2011 UK financial year.
            <br />
		    For further information, please email<a href="mailto:PMEGUIDE@wateraid.org" style="font-size: 14px;">Mike Smith.</a>
        </div>
	</div>

    <div class="exhibit">

 	<!-- Establish our collections-->
    <div ex:role="exhibit-collection" ex:itemTypes="project, component" id="projects"></div>
    <div ex:role="exhibit-collection" ex:itemTypes="summary" id="summary"></div>
    <div ex:role="exhibit-collection" ex:itemTypes="sector" id="sector"></div>

    <!--Set up lens templates: these are used to display each project or summary entry etc.-->

    <!--DATA SUMMARY -->
    <div ex:role="lens" ex:itemTypes="summary" style="display: none" class="data-summary-container exhibit-lens exhibit-ui-protection" ex:formats="date { template: 'MMMM yyyy'; show: date }">
    	<span class="data-summary-text" ex:content=".title"></span>
    </div>

    <!--ORGANISATIONS-->
	<div ex:role="lens" ex:itemTypes="organisation" style="display: none; width: 600" class="data-project exhibit-lens exhibit-ui-protection" >
			<div class="lens-header"><h2 ex:content=".label" class="name"></h2></div>
			<div class="iati-key-info">
            <span class="participating-org"><span ex:if-exists=".countryOfOperation"><span class="field-title">Country Of Operation: </span><span ex:content=".countryOfOperation" class="data-participating-org"></span></span></span>
            </div>
            <span style="font-size: 14px;color: #494436;margin: 5px 0;">More information to follow in the next alpha release</span>
            <!--You can find other projects related to this organisation available from your current query using the menu on the left. Alternatively, you can create a new query to find places where this organisation is <a ex:href-subcontent=".?query=//iati-activity[participating-org/@ref='{{.code}}']">participating</a>.-->
	</div>


    <!--PROJECTS AND COMPONENTS-->
    <div ex:role="lens" ex:itemTypes="project, component" style="display: none" class="data-project exhibit-lens exhibit-ui-protection" ex:formats="date { template: 'MMMM yyyy'; show: date }">
    	<div class="lens-header">
            <!-- <a ex:href-subcontent="activity/?activity={{.iati-identifier}}&TB_iframe=true&height=500&width=800" class="activitydetails" onclick="return showThickbox(this);" ex:title-subcontent="Project details {{.title}}">View details</a>-->
			<!-- <a ex:href-subcontent=".uri" class="activitydetails" >Activity Website</a> -->
            <a ex:href-content=".uri" class="activitydetails" target="_blank">Country Programme Website</a>
            <h2 ex:content=".title" class="name"></h2>
		</div>
    	<div class="lens-inner">
        	<div class="iati-image">
                <img ex:src-subcontent="https://chart.googleapis.com/chart?cht=map:fixed=-55,-180,73,180&chs=280x110&chld={{.recipient-country-code}}&chco=676767|EA600A&chm=f{{.recipient-country}},000000,0,0,10&chf=bg,s,F8F8F8"/>
    			<img ex:src-subcontent="https://chart.googleapis.com/chart?cht=p3&chds=a&chd=t:{{.transaction-unrestricted}},{{.transaction-restricted}}&chs=290x100&chl=Unrestricted|Restricted" />
            <!-- to get a legend with values &chdl={{.transaction-unrestricted}}|{{.transaction-restricted}} -->
            </div>

    		<div class="iati-key-info">
    			<!-- <span class="reporting-org"><span class="field-title">Reporting organisation:</span> <span ex:content=".reporting-org" class="data-reporting-org"></span></span> -->
    			<span class="participating-org"><span class="field-title">Participating organisations:</span> <span ex:content=".participating-org" class="data-participating-org"></span></span>
    		</div>

    		<div class="iati-key-info country">
    			<!-- <span ex:content=".recipient-country" class="data-country"></span> -->
    			<!-- <span class="dates-planned"><span ex:content=".start-date-planned"></span> - <span ex:content="if(exists(.end-date-planned),.end-date-planned,'Unspecified')"> (Planned)</span></span>-->
    			<!-- <span class="dates-actual"><span ex:if-exists=".start-date-actual"><span ex:content=".start-date-actual"></span> - <span ex:content="if(exists(.end-date-actual),.end-date-actual,'Unspecified')"></span> (Actual)</span></span>-->

                <span class="activity-status"><span ex:if-exists=".activity-status"><span class="field-title">Status:</span> <span ex:content=".activity-status"></span></span></span>

    			<span class="dates-actual"><span ex:if-exists=".start-date-actual">From: <span ex:content=".start-date-actual"></span> - <span ex:content="if(exists(.end-date-actual),.end-date-actual,'Unspecified')"></span></span></span>
    		<!-- - <span ex:content="if(exists(.end-date-actual),.end-date-actual,'Unspecified')"></span> -->
    		</div>

            <div ex:content=".description" class="description"></div>

            <div class="funding">
                    <span class="funding-title">2010-2011 consolidated reporting<br /></span>
    				<span class="field-title">Commitments:</span> <span ex:content=".default-currency"></span>&nbsp;<span ex:formats="currency {decimal-digits:2; negative-format: red}" ex:content="add(.total-commitments-current)"></span>
    				<span class="field-title">Disbursements:</span> <span ex:content=".default-currency"></span>&nbsp; <span ex:formats="currency {decimal-digits:2}" ex:content="add(.total-disbursment-current)"></span>
    				<span class="field-title">Expenditures:</span> <span ex:content=".default-currency"></span>&nbsp; <span ex:content="add(.total-expenditure-current)"></span>
    				<!-- <span class="field-title">Total Expenditures:</span> &nbsp;<span ex:content=".default-currency"></span>&nbsp; <span ex:content="add(.total-expenditure-current,.total-disbursment-current,.total-reimbursment-current)"></span> -->
    				<span class="field-title">Loan and Interest Repayments:</span> &nbsp;<span ex:content=".default-currency"></span>&nbsp; <span ex:content="add(.total-loan-repayment-current,.total-interest-repayment-current)"></span>
    		</div>


    		<div class="funding">
                    <span class="funding-title">2009-2010 consolidated reporting<br /></span>
    				<span class="field-title">Commitments:</span> <span ex:content=".default-currency"></span>&nbsp;<span ex:formats="currency {decimal-digits:2; negative-format: red}" ex:content="add(.total-commitments-previous)"></span>
    				<span class="field-title">Disbursements:</span> <span ex:content=".default-currency"></span>&nbsp; <span ex:formats="currency {decimal-digits:2}" ex:content="add(.total-disbursment-previous)"></span>
    				<span class="field-title">Expenditures:</span> <span ex:content=".default-currency"></span>&nbsp; <span ex:content="add(.total-expenditure-previous)"></span>
    				<!-- <span class="field-title">Total Expenditures:</span> &nbsp;<span ex:content=".default-currency"></span>&nbsp; <span ex:content="add(.total-expenditure-previous,.total-disbursment-previous,.total-reimbursment-previous)"></span> -->
    				<span class="field-title">Loan and Interest Repayments:</span> &nbsp;<span ex:content=".default-currency"></span>&nbsp; <span ex:content="add(.total-loan-repayment-previous,.total-interest-repayment-previous)"></span>
    		</div>
    		<div class="iati-aidtype">
    			<!--<span ex:content=".default-flow-type"></span> - <span ex:content=".default-aid-type"></span> - <span ex:content=".collaboration-type"></span> - <span ex:content=".default-tied-status"></span>-->
    			Sector: <span ex:content=".sector"></span> (<span ex:content=".collaboration-type"></span>)
            </div>

            <div class="partnerTable">
            <!-- cant put spans in tables, but might be able to have col groups?<table> </table> for meantime just putting header in JSON -->
                <span ex:content=".table"></span>
            </div>

            <!-- <div ex:content=".uri" class="description"></div> -->
            <!-- <div class="id">
    			<a ex:href-subcontent="activity/?activity={{.iati-identifier}}" class="activitydetails">View details</a>
    		</div>-->

    	</div><!--/lens-inner-->
    </div><!--/project lens-->

    <!--Page layout - this is where the page layout is generated -->
    <div id="sidebar">
        <div ex:role="facet" ex:facetClass="TextSearch" id="textSearch" ex:label="Search"  ex:collectionID="projects"></div>
        <!-- <div ex:role="facet" ex:expression=".reporting-org" ex:collectionID="projects" ex:height="60"></div> -->
        <!--<div ex:role="facet" ex:expression=".funding-org" ex:collectionID="projects" ex:height="60"></div>-->
        <div ex:role="facet" ex:expression=".participating-org" ex:collectionID="projects" ex:height="180"></div>
        <div ex:role="facet" ex:expression=".recipient-region" ex:height="100" ex:collectionID="projects"></div>
        <div ex:role="facet" ex:expression=".recipient-country-code.label" ex:height="100" ex:collectionID="projects" ex:facetLabel="Country"></div>
        <!-- <div ex:role="facet" ex:expression=".activity-status" ex:height="60" ex:collectionID="projects"></div> -->
        <div ex:role="facet" ex:expression=".start-date-actual" ex:collectionID="projects" ex:facetLabel="Start Date"></div>
		<div ex:role="facet" ex:expression=".sector" ex:collectionID="projects" ex:height="60"></div>
		<!-- <div ex:role="facet" ex:expression=".policy-marker" ex:collectionID="projects"></div> -->
        <!-- <div ex:role="facet" ex:expression=".default-aid-type" ex:height="80" ex:collectionID="projects"></div> -->
        <div ex:role="facet" ex:expression=".type" ex:collectionID="projects" ex:height="30"></div>
    </div>
    <div id="results-table" ex:role="viewPanel">
        <div ex:role="view"
                ex:orders=".total-expenditure-current, .title"
                ex:possibleOrders=".total-expenditure-current, .total-expenditure-previous, .title, .iati-identifier, .uri, .start-date-actual, .participating-org, .sector, .recipient-country, .recipient-region, .transaction-restricted, .transaction-unrestricted"
                ex:bubbleWidth="600"
            	ex:collectionID="projects"
                ex:directions="descending"
            	ex:grouped="false"
            	ex:showSummary="false"
                ex:showToolbox="false"></div>

        <div ex:role="view"
            	ex:viewClass="Tabular"
            	ex:columns=".title-link, .iati-identifier, .total-expenditure-current,.total-expenditure-previous,.transaction-restricted,.transaction-unrestricted"
            	ex:bubbleWidth="600"
                ex:collectionID="projects"
                ex:showToolbox="false"
                ex:rowStyler="zebraStyler"></div>

		<div ex:role="view"
			    ex:viewClass="Timeline"
			    ex:start=".start-date-actual"
                ex:end=".last-updated-datetime"
                ex:timeline_stop=".last-updated-datetime"
                ex:centersOn="1993-06-01"
                ex:isDuration="true"
			    ex:topBandUnit="year"
			    ex:topBandIntervalPixels="500"
			    ex:bottomBandIntervalPixels="100"
			    ex:bubbleWidth="550"
			    ex:bubbleHeight="100"
                ex:timelineHeight="500"
                ex:bubbleTip="bottom"
			    ex:densityFactor="1"
				ex:collectionID="projects"
                ex:showToolbox="false"></div>

                <!-- only one colour hence no need for key ex:colorKey=".reporting-org.label"
                ex:end=".end-date-actual"
                javascript:datePlease() -->

		    <div ex:role="view"
			    ex:viewClass="Map"
                ex:label="Location"
                ex:latlng=".approxLocation"
                ex:center="25.2, 40"
                ex:zoom="3"
                ex:mapHeight="900"
                ex:bubbleWidth="300"
                ex:bubbleHeight="1500"
 			    ex:collectionID="projects"
                ex:showToolbox="false"
                ex:opacity="0"></div>

                <!-- only one activity status (implemented) so no need for colour key
                            ex:colorKey=".activity-status"
                doesnt seem to want me to use a different image ex:icon="url(./img/waterdroplet.png)"
                ex:iconFit="none"
                ex:shape="square"
                ex:shapeWidth="50"
                ex:shapeHeight="35"-->
    </div>
    <br style="clear:both"/>
</div>

</div>
</body>
</html>
